export PATH=~/.local/bin:$PATH

umask 0022
alias ls='ls -G --color=auto'
alias ll='ls -lh --color=auto'
alias la='ls -a --color=auto'

export LC_ALL="en_US.UTF-8"

function git_branch_name()
{
  git_status=$(git status -s 2>/dev/null | head -1)
  if [ "$git_status" != "" ]
  then
    color="\033[01;31m"
  else
    color="\033[01;32m"
  fi

  branch=$(git branch 2>/dev/null | grep '^*' | sed "s/^\* \(.*\)$/\1/g")
  if [ "$branch" = "" ]
  then
    :
  else
    echo "on ${color}${branch}\033[m"
  fi
}

if [ "$SHELL" = "/bin/zsh" ]
then
  setopt prompt_subst
  bindkey -v
  bindkey '^R' history-incremental-pattern-search-backward
  export PS1='%(?.%F{green}✓.%F{red}✗)%f%D{%H:%M:%S} [%n@%m:%~] $(git_branch_name)
%# '
  set -o emacs
else
  export PS1='`if [ "$?" == "0" ]; then echo "\[\033[01;32m\]✓"; else echo "\[\033[01;31m\]✗"; fi`\t\[\033[m\] [`if [ "$(id -u)" = "0" ]; then echo "\[\033[01;31m\]"; fi`\u\[\033[m\]@\h:\w] \[\033[32m\]`if [ "$(git status -s 2>/dev/null | head -1)" != "" ]; then echo "\[\033[01;31m\]"; fi``git branch 2>/dev/null | grep ^* | sed "s/^\* \(.*\)$/\1/g"`\[\033[m\]\n\$ '
fi

# Go
export GOPATH=~/.local

# nvim
if [ "$(which nvim)" != "nvim not found" ]; then
  export EDITOR=nvim
  alias vi='nvim'
  alias nv='nvim'
fi

# macOS
if [ `uname` = "Darwin" ]; then
  # Homebrew
  if [ -e /opt/homebrew/bin/brew ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"

    FPATH="$(brew --prefix)/share/zsh/site-functions:${FPATH}"

    autoload -Uz compinit
    compinit
  fi
fi

# Google Env
if which lsb_release >/dev/null; then
  if [ $(lsb_release -cs) = "rodete" ]; then
    alias txa='tmx2 attach'
    alias sandman='/google/data/ro/projects/sandman/sandman'
    alias gemini='/google/bin/releases/gemini-cli/tools/gemini'
  fi

  if [ "$(which gcertfdasfsda)" != "" ]
    gcertstatus -check_remaining=6h >/dev/null 2>&1
    if [ "$?" != "0" ]; then
      gcert
    fi
  fi

  if [[ "$-" =~ "i" ]] && [ -z "$TMUX" ] && [ -n "$SSH_TTY" ]; then
    tmux attach-session -t ssh_tmux || tmux new-session -s ssh_tmux
  fi
fi
